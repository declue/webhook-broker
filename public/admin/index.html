<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Webhook Broker Admin</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #0a0a0b;
      --bg-secondary: #111113;
      --bg-tertiary: #18181b;
      --bg-card: #1c1c1f;
      --bg-hover: #252529;
      --border-color: #2a2a2f;
      --border-accent: #3f3f46;
      --text-primary: #fafafa;
      --text-secondary: #a1a1aa;
      --text-muted: #71717a;
      --accent-green: #22c55e;
      --accent-green-dim: rgba(34, 197, 94, 0.15);
      --accent-red: #ef4444;
      --accent-red-dim: rgba(239, 68, 68, 0.15);
      --accent-yellow: #eab308;
      --accent-yellow-dim: rgba(234, 179, 8, 0.15);
      --accent-blue: #3b82f6;
      --accent-blue-dim: rgba(59, 130, 246, 0.15);
      --accent-purple: #a855f7;
      --font-mono: 'JetBrains Mono', monospace;
      --font-sans: 'Outfit', sans-serif;
      --radius-sm: 4px;
      --radius-md: 8px;
      --radius-lg: 12px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-sans);
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Login Screen */
    .login-screen {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background:
        radial-gradient(ellipse at 20% 50%, rgba(34, 197, 94, 0.08) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 50%, rgba(59, 130, 246, 0.08) 0%, transparent 50%),
        var(--bg-primary);
    }

    .login-box {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 48px;
      width: 100%;
      max-width: 420px;
      animation: slideUp 0.5s ease-out;
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .login-logo {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 32px;
    }

    .login-logo-icon {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, var(--accent-green), var(--accent-blue));
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }

    .login-logo-text {
      font-size: 20px;
      font-weight: 600;
      letter-spacing: -0.5px;
    }

    .login-logo-sub {
      font-size: 12px;
      color: var(--text-muted);
      font-family: var(--font-mono);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .login-title {
      font-size: 28px;
      font-weight: 600;
      margin-bottom: 8px;
      letter-spacing: -0.5px;
    }

    .login-desc {
      color: var(--text-secondary);
      margin-bottom: 32px;
      line-height: 1.6;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: 8px;
      font-family: var(--font-mono);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .form-input {
      width: 100%;
      padding: 14px 16px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-family: var(--font-mono);
      font-size: 14px;
      transition: all 0.2s;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--accent-green);
      box-shadow: 0 0 0 3px var(--accent-green-dim);
    }

    .btn {
      width: 100%;
      padding: 14px 24px;
      background: var(--accent-green);
      color: #000;
      border: none;
      border-radius: var(--radius-md);
      font-family: var(--font-sans);
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn:hover {
      background: #16a34a;
      transform: translateY(-1px);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .error-msg {
      background: var(--accent-red-dim);
      border: 1px solid var(--accent-red);
      color: var(--accent-red);
      padding: 12px 16px;
      border-radius: var(--radius-md);
      font-size: 13px;
      margin-bottom: 20px;
      display: none;
    }

    .error-msg.show {
      display: block;
      animation: shake 0.4s ease-out;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    /* Dashboard Layout */
    .dashboard {
      display: none;
      min-height: 100vh;
    }

    .dashboard.show {
      display: flex;
    }

    /* Sidebar */
    .sidebar {
      width: 260px;
      background: var(--bg-secondary);
      border-right: 1px solid var(--border-color);
      display: flex;
      flex-direction: column;
      position: fixed;
      height: 100vh;
      z-index: 100;
    }

    .sidebar-header {
      padding: 24px;
      border-bottom: 1px solid var(--border-color);
    }

    .sidebar-logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .sidebar-logo-icon {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, var(--accent-green), var(--accent-blue));
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .sidebar-logo-text {
      font-weight: 600;
      font-size: 16px;
    }

    .sidebar-nav {
      flex: 1;
      padding: 16px 12px;
      overflow-y: auto;
    }

    .nav-section {
      margin-bottom: 24px;
    }

    .nav-section-title {
      font-size: 11px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 1px;
      padding: 8px 12px;
      font-family: var(--font-mono);
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      border-radius: var(--radius-md);
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.15s;
      font-size: 14px;
      font-weight: 500;
    }

    .nav-item:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .nav-item.active {
      background: var(--accent-green-dim);
      color: var(--accent-green);
    }

    .nav-icon {
      font-size: 18px;
      width: 24px;
      text-align: center;
    }

    .sidebar-footer {
      padding: 16px;
      border-top: 1px solid var(--border-color);
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: var(--bg-tertiary);
      border-radius: var(--radius-md);
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--border-accent);
    }

    .user-details {
      flex: 1;
      min-width: 0;
    }

    .user-name {
      font-weight: 500;
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .user-role {
      font-size: 11px;
      color: var(--accent-green);
      font-family: var(--font-mono);
      text-transform: uppercase;
    }

    .logout-btn {
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      font-size: 18px;
      padding: 4px;
      transition: color 0.2s;
    }

    .logout-btn:hover {
      color: var(--accent-red);
    }

    /* Main Content */
    .main-content {
      flex: 1;
      margin-left: 260px;
      min-height: 100vh;
    }

    .content-header {
      padding: 24px 32px;
      border-bottom: 1px solid var(--border-color);
      background: var(--bg-secondary);
      position: sticky;
      top: 0;
      z-index: 50;
    }

    .content-title {
      font-size: 24px;
      font-weight: 600;
      letter-spacing: -0.5px;
    }

    .content-subtitle {
      color: var(--text-muted);
      font-size: 14px;
      margin-top: 4px;
    }

    .content-body {
      padding: 32px;
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 32px;
    }

    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 24px;
      transition: all 0.2s;
    }

    .stat-card:hover {
      border-color: var(--border-accent);
      transform: translateY(-2px);
    }

    .stat-icon {
      width: 44px;
      height: 44px;
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      margin-bottom: 16px;
    }

    .stat-icon.green { background: var(--accent-green-dim); color: var(--accent-green); }
    .stat-icon.blue { background: var(--accent-blue-dim); color: var(--accent-blue); }
    .stat-icon.yellow { background: var(--accent-yellow-dim); color: var(--accent-yellow); }
    .stat-icon.purple { background: rgba(168, 85, 247, 0.15); color: var(--accent-purple); }

    .stat-value {
      font-size: 32px;
      font-weight: 700;
      font-family: var(--font-mono);
      letter-spacing: -1px;
      margin-bottom: 4px;
    }

    .stat-label {
      font-size: 13px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Data Table */
    .table-container {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      overflow: hidden;
    }

    .table-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 24px;
      border-bottom: 1px solid var(--border-color);
    }

    .table-title {
      font-size: 16px;
      font-weight: 600;
    }

    .table-actions {
      display: flex;
      gap: 12px;
    }

    .search-input {
      padding: 10px 16px;
      padding-left: 40px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-size: 13px;
      width: 240px;
      transition: all 0.2s;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--accent-green);
    }

    .search-wrapper {
      position: relative;
    }

    .search-icon {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
      font-size: 14px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th {
      text-align: left;
      padding: 14px 24px;
      font-size: 11px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-family: var(--font-mono);
      border-bottom: 1px solid var(--border-color);
      background: var(--bg-tertiary);
    }

    td {
      padding: 16px 24px;
      font-size: 14px;
      border-bottom: 1px solid var(--border-color);
    }

    tr:hover td {
      background: var(--bg-hover);
    }

    tr:last-child td {
      border-bottom: none;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 100px;
      font-size: 11px;
      font-weight: 600;
      font-family: var(--font-mono);
      text-transform: uppercase;
    }

    .badge.admin {
      background: var(--accent-purple);
      background: rgba(168, 85, 247, 0.2);
      color: var(--accent-purple);
    }

    .badge.user {
      background: var(--accent-blue-dim);
      color: var(--accent-blue);
    }

    .badge.active {
      background: var(--accent-green-dim);
      color: var(--accent-green);
    }

    .badge.inactive {
      background: var(--accent-red-dim);
      color: var(--accent-red);
    }

    .badge.success {
      background: var(--accent-green-dim);
      color: var(--accent-green);
    }

    .badge.error {
      background: var(--accent-red-dim);
      color: var(--accent-red);
    }

    .avatar-cell {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .avatar-img {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--border-accent);
    }

    .avatar-name {
      font-weight: 500;
    }

    .avatar-email {
      font-size: 12px;
      color: var(--text-muted);
    }

    .action-btn {
      background: none;
      border: 1px solid var(--border-color);
      color: var(--text-secondary);
      padding: 6px 12px;
      border-radius: var(--radius-sm);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.15s;
      font-family: var(--font-mono);
    }

    .action-btn:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
      border-color: var(--border-accent);
    }

    .action-btn.danger:hover {
      background: var(--accent-red-dim);
      color: var(--accent-red);
      border-color: var(--accent-red);
    }

    /* Pagination */
    .pagination {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 24px;
      border-top: 1px solid var(--border-color);
    }

    .pagination-info {
      font-size: 13px;
      color: var(--text-muted);
    }

    .pagination-buttons {
      display: flex;
      gap: 8px;
    }

    .page-btn {
      padding: 8px 14px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-sm);
      color: var(--text-secondary);
      font-size: 13px;
      cursor: pointer;
      transition: all 0.15s;
    }

    .page-btn:hover:not(:disabled) {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .page-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .page-btn.active {
      background: var(--accent-green);
      color: #000;
      border-color: var(--accent-green);
    }

    /* Status Indicator */
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 8px;
    }

    .status-dot.healthy { background: var(--accent-green); }
    .status-dot.unhealthy { background: var(--accent-red); }

    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal-overlay.show {
      display: flex;
    }

    .modal {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      width: 100%;
      max-width: 500px;
      animation: modalSlide 0.2s ease-out;
    }

    @keyframes modalSlide {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    .modal-header {
      padding: 24px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .modal-title {
      font-size: 18px;
      font-weight: 600;
    }

    .modal-close {
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 24px;
      cursor: pointer;
      transition: color 0.15s;
    }

    .modal-close:hover {
      color: var(--text-primary);
    }

    .modal-body {
      padding: 24px;
    }

    .modal-footer {
      padding: 16px 24px;
      border-top: 1px solid var(--border-color);
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }

    .modal-btn {
      padding: 10px 20px;
      border-radius: var(--radius-md);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s;
    }

    .modal-btn.secondary {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
    }

    .modal-btn.secondary:hover {
      background: var(--bg-hover);
    }

    .modal-btn.primary {
      background: var(--accent-green);
      border: none;
      color: #000;
    }

    .modal-btn.primary:hover {
      background: #16a34a;
    }

    .modal-btn.danger {
      background: var(--accent-red);
      border: none;
      color: #fff;
    }

    /* Toast */
    .toast-container {
      position: fixed;
      top: 24px;
      right: 24px;
      z-index: 2000;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .toast {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      padding: 16px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 300px;
      animation: toastSlide 0.3s ease-out;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    }

    @keyframes toastSlide {
      from { opacity: 0; transform: translateX(100%); }
      to { opacity: 1; transform: translateX(0); }
    }

    .toast.success { border-left: 3px solid var(--accent-green); }
    .toast.error { border-left: 3px solid var(--accent-red); }
    .toast.info { border-left: 3px solid var(--accent-blue); }

    .toast-icon {
      font-size: 18px;
    }

    .toast.success .toast-icon { color: var(--accent-green); }
    .toast.error .toast-icon { color: var(--accent-red); }
    .toast.info .toast-icon { color: var(--accent-blue); }

    .toast-message {
      flex: 1;
      font-size: 14px;
    }

    /* Loading */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 60px;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border-color);
      border-top-color: var(--accent-green);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px;
      color: var(--text-muted);
    }

    .empty-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    /* Section Cards */
    .section-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 24px;
      margin-bottom: 32px;
    }

    .section-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 24px;
    }

    .section-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .section-card-title {
      font-size: 16px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .service-status {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .service-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      background: var(--bg-secondary);
      border-radius: var(--radius-md);
    }

    .service-name {
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .service-detail {
      font-size: 12px;
      color: var(--text-muted);
      font-family: var(--font-mono);
    }

    /* Code Block */
    .code-block {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      padding: 16px;
      font-family: var(--font-mono);
      font-size: 13px;
      overflow-x: auto;
      max-height: 300px;
      overflow-y: auto;
    }

    /* Settings Form */
    .settings-form {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .setting-item {
      display: flex;
      align-items: flex-start;
      gap: 20px;
      padding: 20px;
      background: var(--bg-secondary);
      border-radius: var(--radius-md);
    }

    .setting-info {
      flex: 1;
    }

    .setting-key {
      font-family: var(--font-mono);
      font-weight: 600;
      margin-bottom: 4px;
    }

    .setting-desc {
      font-size: 13px;
      color: var(--text-muted);
    }

    .setting-value {
      width: 300px;
    }

    .setting-input {
      width: 100%;
      padding: 10px 14px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      font-family: var(--font-mono);
      font-size: 13px;
    }

    .setting-input:focus {
      outline: none;
      border-color: var(--accent-green);
    }

    /* Tab System */
    .tabs {
      display: flex;
      gap: 4px;
      padding: 4px;
      background: var(--bg-secondary);
      border-radius: var(--radius-md);
      margin-bottom: 24px;
    }

    .tab-btn {
      flex: 1;
      padding: 10px 16px;
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      border-radius: var(--radius-sm);
      transition: all 0.15s;
    }

    .tab-btn:hover {
      color: var(--text-primary);
    }

    .tab-btn.active {
      background: var(--bg-card);
      color: var(--text-primary);
    }

    /* Hidden */
    .hidden {
      display: none !important;
    }

    /* Responsive */
    @media (max-width: 1200px) {
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
      }
      .main-content {
        margin-left: 0;
      }
      .stats-grid {
        grid-template-columns: 1fr;
      }
      .section-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Login Screen -->
  <div class="login-screen" id="loginScreen">
    <div class="login-box">
      <div class="login-logo">
        <div class="login-logo-icon">W</div>
        <div>
          <div class="login-logo-text">Webhook Broker</div>
          <div class="login-logo-sub">Admin Console</div>
        </div>
      </div>
      <h1 class="login-title">Sign In</h1>
      <p class="login-desc">Enter your access token to continue to the admin dashboard.</p>

      <div class="error-msg" id="loginError"></div>

      <form id="loginForm">
        <div class="form-group">
          <label class="form-label">Access Token</label>
          <input type="password" class="form-input" id="tokenInput" placeholder="Enter your JWT token" required>
        </div>
        <button type="submit" class="btn" id="loginBtn">
          <span>Access Dashboard</span>
        </button>
      </form>
    </div>
  </div>

  <!-- Dashboard -->
  <div class="dashboard" id="dashboard">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <div class="sidebar-logo-icon">W</div>
          <span class="sidebar-logo-text">Webhook Broker</span>
        </div>
      </div>

      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Overview</div>
          <div class="nav-item active" data-page="dashboard">
            <span class="nav-icon">&#9673;</span>
            <span>Dashboard</span>
          </div>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Management</div>
          <div class="nav-item" data-page="users">
            <span class="nav-icon">&#9775;</span>
            <span>Users</span>
          </div>
          <div class="nav-item" data-page="consumers">
            <span class="nav-icon">&#9781;</span>
            <span>Consumers</span>
          </div>
          <div class="nav-item" data-page="webhooks">
            <span class="nav-icon">&#10140;</span>
            <span>Webhook Logs</span>
          </div>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">System</div>
          <div class="nav-item" data-page="settings">
            <span class="nav-icon">&#9881;</span>
            <span>Settings</span>
          </div>
          <div class="nav-item" data-page="dlq">
            <span class="nav-icon">&#9888;</span>
            <span>Dead Letter Queue</span>
          </div>
          <div class="nav-item" data-page="audit">
            <span class="nav-icon">&#128220;</span>
            <span>Audit Logs</span>
          </div>
        </div>
      </nav>

      <div class="sidebar-footer">
        <div class="user-info">
          <img class="user-avatar" id="userAvatar" src="" alt="">
          <div class="user-details">
            <div class="user-name" id="userName">Admin</div>
            <div class="user-role">ADMIN</div>
          </div>
          <button class="logout-btn" id="logoutBtn" title="Logout">&#10005;</button>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Dashboard Page -->
      <div class="page" id="page-dashboard">
        <header class="content-header">
          <h1 class="content-title">Dashboard</h1>
          <p class="content-subtitle">System overview and metrics</p>
        </header>
        <div class="content-body">
          <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
              <div class="stat-icon green">&#9775;</div>
              <div class="stat-value" id="statUsers">-</div>
              <div class="stat-label">Total Users</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon blue">&#9781;</div>
              <div class="stat-value" id="statConsumers">-</div>
              <div class="stat-label">Active Consumers</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon yellow">&#10140;</div>
              <div class="stat-value" id="statWebhooks">-</div>
              <div class="stat-label">Webhooks (24h)</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon purple">&#9201;</div>
              <div class="stat-value" id="statUptime">-</div>
              <div class="stat-label">Uptime</div>
            </div>
          </div>

          <div class="section-grid">
            <div class="section-card">
              <div class="section-card-header">
                <h3 class="section-card-title">&#9889; Service Status</h3>
              </div>
              <div class="service-status" id="serviceStatus">
                <div class="service-row">
                  <span class="service-name">
                    <span class="status-dot healthy" id="natsStatus"></span>
                    NATS JetStream
                  </span>
                  <span class="service-detail" id="natsDetail">-</span>
                </div>
                <div class="service-row">
                  <span class="service-name">
                    <span class="status-dot healthy" id="redisStatus"></span>
                    Redis
                  </span>
                  <span class="service-detail" id="redisDetail">-</span>
                </div>
                <div class="service-row">
                  <span class="service-name">
                    <span class="status-dot healthy" id="dbStatus"></span>
                    PostgreSQL
                  </span>
                  <span class="service-detail" id="dbDetail">Connected</span>
                </div>
              </div>
            </div>

            <div class="section-card">
              <div class="section-card-header">
                <h3 class="section-card-title">&#128202; Quick Stats</h3>
              </div>
              <div class="service-status">
                <div class="service-row">
                  <span class="service-name">Active Users</span>
                  <span class="service-detail" id="activeUsers">-</span>
                </div>
                <div class="service-row">
                  <span class="service-name">Total Webhooks</span>
                  <span class="service-detail" id="totalWebhooks">-</span>
                </div>
                <div class="service-row">
                  <span class="service-name">Stream Messages</span>
                  <span class="service-detail" id="streamMessages">-</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Users Page -->
      <div class="page hidden" id="page-users">
        <header class="content-header">
          <h1 class="content-title">Users</h1>
          <p class="content-subtitle">Manage user accounts and permissions</p>
        </header>
        <div class="content-body">
          <div class="table-container">
            <div class="table-header">
              <h3 class="table-title">All Users</h3>
              <div class="table-actions">
                <div class="search-wrapper">
                  <span class="search-icon">&#128269;</span>
                  <input type="text" class="search-input" id="userSearch" placeholder="Search users...">
                </div>
              </div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>User</th>
                  <th>Role</th>
                  <th>Status</th>
                  <th>Consumers</th>
                  <th>Created</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="usersTableBody">
              </tbody>
            </table>
            <div class="pagination" id="usersPagination">
              <div class="pagination-info">Showing 0 of 0 users</div>
              <div class="pagination-buttons"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Consumers Page -->
      <div class="page hidden" id="page-consumers">
        <header class="content-header">
          <h1 class="content-title">Consumers</h1>
          <p class="content-subtitle">NATS consumer management</p>
        </header>
        <div class="content-body">
          <div class="table-container">
            <div class="table-header">
              <h3 class="table-title">All Consumers</h3>
            </div>
            <table>
              <thead>
                <tr>
                  <th>Consumer</th>
                  <th>User</th>
                  <th>Subjects</th>
                  <th>Pending</th>
                  <th>Delivered</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="consumersTableBody">
              </tbody>
            </table>
            <div class="pagination" id="consumersPagination">
              <div class="pagination-info">Showing 0 of 0 consumers</div>
              <div class="pagination-buttons"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Webhooks Page -->
      <div class="page hidden" id="page-webhooks">
        <header class="content-header">
          <h1 class="content-title">Webhook Logs</h1>
          <p class="content-subtitle">Recent webhook activity</p>
        </header>
        <div class="content-body">
          <div class="table-container">
            <div class="table-header">
              <h3 class="table-title">Recent Webhooks</h3>
              <div class="table-actions">
                <select class="search-input" id="webhookFilter" style="width: 150px; padding-left: 14px;">
                  <option value="">All Status</option>
                  <option value="success">Success</option>
                  <option value="error">Error</option>
                </select>
              </div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>Path</th>
                  <th>Source</th>
                  <th>Status</th>
                  <th>Size</th>
                  <th>Time</th>
                </tr>
              </thead>
              <tbody id="webhooksTableBody">
              </tbody>
            </table>
            <div class="pagination" id="webhooksPagination">
              <div class="pagination-info">Showing 0 of 0 webhooks</div>
              <div class="pagination-buttons"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Settings Page -->
      <div class="page hidden" id="page-settings">
        <header class="content-header">
          <h1 class="content-title">Settings</h1>
          <p class="content-subtitle">System configuration</p>
        </header>
        <div class="content-body">
          <div class="table-container">
            <div class="table-header">
              <h3 class="table-title">System Settings</h3>
              <button class="action-btn" id="addSettingBtn">+ Add Setting</button>
            </div>
            <div class="settings-form" id="settingsForm">
            </div>
          </div>
        </div>
      </div>

      <!-- DLQ Page -->
      <div class="page hidden" id="page-dlq">
        <header class="content-header">
          <h1 class="content-title">Dead Letter Queue</h1>
          <p class="content-subtitle">Failed messages for review</p>
        </header>
        <div class="content-body">
          <div class="table-container">
            <div class="table-header">
              <h3 class="table-title">DLQ Messages</h3>
            </div>
            <table>
              <thead>
                <tr>
                  <th>Subject</th>
                  <th>Reason</th>
                  <th>Moved At</th>
                </tr>
              </thead>
              <tbody id="dlqTableBody">
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Audit Page -->
      <div class="page hidden" id="page-audit">
        <header class="content-header">
          <h1 class="content-title">Audit Logs</h1>
          <p class="content-subtitle">System activity history</p>
        </header>
        <div class="content-body">
          <div class="table-container">
            <div class="table-header">
              <h3 class="table-title">Recent Activity</h3>
            </div>
            <table>
              <thead>
                <tr>
                  <th>Action</th>
                  <th>User ID</th>
                  <th>Target</th>
                  <th>Time</th>
                  <th>IP Address</th>
                </tr>
              </thead>
              <tbody id="auditTableBody">
              </tbody>
            </table>
            <div class="pagination" id="auditPagination">
              <div class="pagination-info">Showing 0 of 0 logs</div>
              <div class="pagination-buttons"></div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Modal -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title" id="modalTitle">Modal Title</h3>
        <button class="modal-close" id="modalClose">&times;</button>
      </div>
      <div class="modal-body" id="modalBody">
      </div>
      <div class="modal-footer" id="modalFooter">
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

  <script>
    // State
    let token = localStorage.getItem('adminToken');
    let currentUser = null;
    let currentPage = 'dashboard';

    // API Base
    const API_BASE = '/api/v1';

    // Utilities
    async function apiCall(endpoint, options = {}) {
      const response = await fetch(`${API_BASE}${endpoint}`, {
        ...options,
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`,
          ...options.headers,
        },
      });

      if (response.status === 401 || response.status === 403) {
        logout();
        throw new Error('Unauthorized');
      }

      const data = await response.json();

      if (!response.ok) {
        throw new Error(data.error || 'Request failed');
      }

      return data;
    }

    function showToast(message, type = 'info') {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;

      const icons = { success: '&#10003;', error: '&#10007;', info: '&#8505;' };
      toast.innerHTML = `
        <span class="toast-icon">${icons[type]}</span>
        <span class="toast-message">${message}</span>
      `;

      container.appendChild(toast);
      setTimeout(() => toast.remove(), 4000);
    }

    function formatDate(dateStr) {
      return new Date(dateStr).toLocaleString();
    }

    function formatBytes(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
    }

    function formatUptime(seconds) {
      const days = Math.floor(seconds / 86400);
      const hours = Math.floor((seconds % 86400) / 3600);
      const mins = Math.floor((seconds % 3600) / 60);
      if (days > 0) return `${days}d ${hours}h`;
      if (hours > 0) return `${hours}h ${mins}m`;
      return `${mins}m`;
    }

    // Modal
    function showModal(title, body, footer) {
      document.getElementById('modalTitle').textContent = title;
      document.getElementById('modalBody').innerHTML = body;
      document.getElementById('modalFooter').innerHTML = footer;
      document.getElementById('modalOverlay').classList.add('show');
    }

    function hideModal() {
      document.getElementById('modalOverlay').classList.remove('show');
    }

    // Login
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const tokenInput = document.getElementById('tokenInput');
      const errorEl = document.getElementById('loginError');
      const btn = document.getElementById('loginBtn');

      btn.disabled = true;
      btn.innerHTML = '<span class="spinner" style="width:20px;height:20px;border-width:2px;"></span>';

      try {
        token = tokenInput.value;
        localStorage.setItem('adminToken', token);

        // Verify token by fetching stats
        await apiCall('/admin/stats');

        // Get user info
        currentUser = await apiCall('/auth/me');

        showDashboard();
      } catch (err) {
        localStorage.removeItem('adminToken');
        token = null;
        errorEl.textContent = 'Invalid token or insufficient permissions';
        errorEl.classList.add('show');
      } finally {
        btn.disabled = false;
        btn.innerHTML = '<span>Access Dashboard</span>';
      }
    });

    function logout() {
      localStorage.removeItem('adminToken');
      token = null;
      currentUser = null;
      document.getElementById('loginScreen').style.display = 'flex';
      document.getElementById('dashboard').classList.remove('show');
    }

    document.getElementById('logoutBtn').addEventListener('click', logout);

    // Dashboard
    async function showDashboard() {
      document.getElementById('loginScreen').style.display = 'none';
      document.getElementById('dashboard').classList.add('show');

      if (currentUser) {
        document.getElementById('userName').textContent = currentUser.username;
        document.getElementById('userAvatar').src = currentUser.avatarUrl || '';
      }

      loadDashboardStats();
    }

    async function loadDashboardStats() {
      try {
        const stats = await apiCall('/admin/stats');

        document.getElementById('statUsers').textContent = stats.users?.total || 0;
        document.getElementById('statConsumers').textContent = stats.consumers || 0;
        document.getElementById('statWebhooks').textContent = stats.webhooks?.last24h || 0;
        document.getElementById('statUptime').textContent = formatUptime(stats.serverUptime || 0);

        document.getElementById('activeUsers').textContent = stats.users?.active || 0;
        document.getElementById('totalWebhooks').textContent = stats.webhooks?.total || 0;

        // NATS Status
        const nats = stats.services?.nats;
        const natsStatus = document.getElementById('natsStatus');
        natsStatus.className = `status-dot ${nats?.healthy ? 'healthy' : 'unhealthy'}`;
        document.getElementById('natsDetail').textContent = nats?.details?.messages
          ? `${nats.details.messages} msgs` : 'N/A';
        document.getElementById('streamMessages').textContent = nats?.details?.messages || 0;

        // Redis Status
        const redis = stats.services?.redis;
        const redisStatus = document.getElementById('redisStatus');
        redisStatus.className = `status-dot ${redis?.healthy ? 'healthy' : 'unhealthy'}`;
        document.getElementById('redisDetail').textContent = redis?.details?.usedMemory || 'N/A';

      } catch (err) {
        showToast('Failed to load stats', 'error');
      }
    }

    // Navigation
    document.querySelectorAll('.nav-item').forEach(item => {
      item.addEventListener('click', () => {
        const page = item.dataset.page;
        navigateTo(page);
      });
    });

    function navigateTo(page) {
      // Update nav
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      document.querySelector(`[data-page="${page}"]`)?.classList.add('active');

      // Update pages
      document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
      document.getElementById(`page-${page}`)?.classList.remove('hidden');

      currentPage = page;

      // Load data
      switch(page) {
        case 'dashboard': loadDashboardStats(); break;
        case 'users': loadUsers(); break;
        case 'consumers': loadConsumers(); break;
        case 'webhooks': loadWebhooks(); break;
        case 'settings': loadSettings(); break;
        case 'dlq': loadDLQ(); break;
        case 'audit': loadAuditLogs(); break;
      }
    }

    // Users
    let usersPage = 1;
    async function loadUsers(page = 1, search = '') {
      const tbody = document.getElementById('usersTableBody');
      tbody.innerHTML = '<tr><td colspan="6" class="loading"><div class="spinner"></div></td></tr>';

      try {
        const params = new URLSearchParams({ page, limit: 20 });
        if (search) params.set('search', search);

        const data = await apiCall(`/admin/users?${params}`);

        if (data.users.length === 0) {
          tbody.innerHTML = '<tr><td colspan="6" class="empty-state"><div class="empty-icon">&#128100;</div>No users found</td></tr>';
          return;
        }

        tbody.innerHTML = data.users.map(user => `
          <tr>
            <td>
              <div class="avatar-cell">
                <img class="avatar-img" src="${user.avatarUrl || ''}" alt="">
                <div>
                  <div class="avatar-name">${user.username}</div>
                  <div class="avatar-email">${user.email || '-'}</div>
                </div>
              </div>
            </td>
            <td><span class="badge ${user.role.toLowerCase()}">${user.role}</span></td>
            <td><span class="badge ${user.isActive ? 'active' : 'inactive'}">${user.isActive ? 'Active' : 'Inactive'}</span></td>
            <td>${user._count?.consumers || 0}</td>
            <td>${formatDate(user.createdAt)}</td>
            <td>
              <button class="action-btn" onclick="editUser(${user.id})">Edit</button>
            </td>
          </tr>
        `).join('');

        updatePagination('users', data.pagination);
        usersPage = page;
      } catch (err) {
        tbody.innerHTML = '<tr><td colspan="6" class="empty-state">Failed to load users</td></tr>';
      }
    }

    document.getElementById('userSearch').addEventListener('input', debounce((e) => {
      loadUsers(1, e.target.value);
    }, 300));

    function editUser(userId) {
      apiCall(`/admin/users/${userId}`).then(user => {
        showModal('Edit User', `
          <div class="form-group">
            <label class="form-label">Username</label>
            <input type="text" class="form-input" value="${user.username}" disabled>
          </div>
          <div class="form-group">
            <label class="form-label">Role</label>
            <select class="form-input" id="editUserRole">
              <option value="USER" ${user.role === 'USER' ? 'selected' : ''}>User</option>
              <option value="ADMIN" ${user.role === 'ADMIN' ? 'selected' : ''}>Admin</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Status</label>
            <select class="form-input" id="editUserStatus">
              <option value="true" ${user.isActive ? 'selected' : ''}>Active</option>
              <option value="false" ${!user.isActive ? 'selected' : ''}>Inactive</option>
            </select>
          </div>
        `, `
          <button class="modal-btn secondary" onclick="hideModal()">Cancel</button>
          <button class="modal-btn primary" onclick="saveUser(${userId})">Save Changes</button>
        `);
      });
    }

    async function saveUser(userId) {
      const role = document.getElementById('editUserRole').value;
      const isActive = document.getElementById('editUserStatus').value === 'true';

      try {
        await apiCall(`/admin/users/${userId}`, {
          method: 'PATCH',
          body: JSON.stringify({ role, isActive }),
        });
        hideModal();
        showToast('User updated successfully', 'success');
        loadUsers(usersPage);
      } catch (err) {
        showToast(err.message, 'error');
      }
    }

    // Consumers
    async function loadConsumers(page = 1) {
      const tbody = document.getElementById('consumersTableBody');
      tbody.innerHTML = '<tr><td colspan="6" class="loading"><div class="spinner"></div></td></tr>';

      try {
        const data = await apiCall(`/admin/consumers?page=${page}&limit=20`);

        if (data.consumers.length === 0) {
          tbody.innerHTML = '<tr><td colspan="6" class="empty-state"><div class="empty-icon">&#9781;</div>No consumers found</td></tr>';
          return;
        }

        tbody.innerHTML = data.consumers.map(c => `
          <tr>
            <td><code>${c.consumerName}</code></td>
            <td>
              <div class="avatar-cell">
                <img class="avatar-img" src="${c.user?.avatarUrl || ''}" alt="">
                <span>${c.user?.username || '-'}</span>
              </div>
            </td>
            <td>${c.filterSubjects?.length || 0} subjects</td>
            <td>${c.pendingMessages}</td>
            <td>${c.deliveredCount}</td>
            <td>
              <button class="action-btn danger" onclick="deleteConsumer(${c.id}, '${c.consumerName}')">Delete</button>
            </td>
          </tr>
        `).join('');

        updatePagination('consumers', data.pagination);
      } catch (err) {
        tbody.innerHTML = '<tr><td colspan="6" class="empty-state">Failed to load consumers</td></tr>';
      }
    }

    function deleteConsumer(id, name) {
      showModal('Delete Consumer', `
        <p>Are you sure you want to delete consumer <strong>${name}</strong>?</p>
        <p style="color: var(--text-muted); margin-top: 8px;">This action cannot be undone.</p>
      `, `
        <button class="modal-btn secondary" onclick="hideModal()">Cancel</button>
        <button class="modal-btn danger" onclick="confirmDeleteConsumer(${id})">Delete</button>
      `);
    }

    async function confirmDeleteConsumer(id) {
      try {
        await apiCall(`/admin/consumers/${id}`, { method: 'DELETE' });
        hideModal();
        showToast('Consumer deleted successfully', 'success');
        loadConsumers();
      } catch (err) {
        showToast(err.message, 'error');
      }
    }

    // Webhooks
    async function loadWebhooks(page = 1, status = '') {
      const tbody = document.getElementById('webhooksTableBody');
      tbody.innerHTML = '<tr><td colspan="5" class="loading"><div class="spinner"></div></td></tr>';

      try {
        const params = new URLSearchParams({ page, limit: 50 });
        if (status) params.set('status', status);

        const data = await apiCall(`/admin/webhooks?${params}`);

        if (data.webhooks.length === 0) {
          tbody.innerHTML = '<tr><td colspan="5" class="empty-state"><div class="empty-icon">&#10140;</div>No webhooks found</td></tr>';
          return;
        }

        tbody.innerHTML = data.webhooks.map(w => `
          <tr>
            <td><code style="font-size: 12px;">${w.webhookPath}</code></td>
            <td><span class="badge user">${w.source}</span></td>
            <td><span class="badge ${w.statusCode < 400 ? 'success' : 'error'}">${w.statusCode}</span></td>
            <td>${formatBytes(w.payloadSize)}</td>
            <td>${formatDate(w.receivedAt)}</td>
          </tr>
        `).join('');

        updatePagination('webhooks', data.pagination);
      } catch (err) {
        tbody.innerHTML = '<tr><td colspan="5" class="empty-state">Failed to load webhooks</td></tr>';
      }
    }

    document.getElementById('webhookFilter').addEventListener('change', (e) => {
      loadWebhooks(1, e.target.value);
    });

    // Settings
    async function loadSettings() {
      const form = document.getElementById('settingsForm');
      form.innerHTML = '<div class="loading"><div class="spinner"></div></div>';

      try {
        const data = await apiCall('/admin/settings');

        if (data.settings.length === 0) {
          form.innerHTML = '<div class="empty-state"><div class="empty-icon">&#9881;</div>No settings configured</div>';
          return;
        }

        form.innerHTML = data.settings.map(s => `
          <div class="setting-item">
            <div class="setting-info">
              <div class="setting-key">${s.key}</div>
              <div class="setting-desc">${s.description || 'No description'}</div>
            </div>
            <div class="setting-value">
              <input type="text" class="setting-input" id="setting-${s.key}" value="${s.value}" data-key="${s.key}">
            </div>
          </div>
        `).join('');

        // Add save handlers
        form.querySelectorAll('.setting-input').forEach(input => {
          input.addEventListener('blur', () => saveSetting(input.dataset.key, input.value));
        });
      } catch (err) {
        form.innerHTML = '<div class="empty-state">Failed to load settings</div>';
      }
    }

    async function saveSetting(key, value) {
      try {
        await apiCall(`/admin/settings/${key}`, {
          method: 'PUT',
          body: JSON.stringify({ value }),
        });
        showToast('Setting saved', 'success');
      } catch (err) {
        showToast(err.message, 'error');
      }
    }

    document.getElementById('addSettingBtn').addEventListener('click', () => {
      showModal('Add Setting', `
        <div class="form-group">
          <label class="form-label">Key</label>
          <input type="text" class="form-input" id="newSettingKey" placeholder="setting.key">
        </div>
        <div class="form-group">
          <label class="form-label">Value</label>
          <input type="text" class="form-input" id="newSettingValue" placeholder="value">
        </div>
        <div class="form-group">
          <label class="form-label">Description</label>
          <input type="text" class="form-input" id="newSettingDesc" placeholder="Optional description">
        </div>
      `, `
        <button class="modal-btn secondary" onclick="hideModal()">Cancel</button>
        <button class="modal-btn primary" onclick="addSetting()">Add Setting</button>
      `);
    });

    async function addSetting() {
      const key = document.getElementById('newSettingKey').value;
      const value = document.getElementById('newSettingValue').value;
      const description = document.getElementById('newSettingDesc').value;

      if (!key || !value) {
        showToast('Key and value are required', 'error');
        return;
      }

      try {
        await apiCall(`/admin/settings/${key}`, {
          method: 'PUT',
          body: JSON.stringify({ value, description }),
        });
        hideModal();
        showToast('Setting added', 'success');
        loadSettings();
      } catch (err) {
        showToast(err.message, 'error');
      }
    }

    // DLQ
    async function loadDLQ() {
      const tbody = document.getElementById('dlqTableBody');
      tbody.innerHTML = '<tr><td colspan="3" class="loading"><div class="spinner"></div></td></tr>';

      try {
        const data = await apiCall('/admin/dlq?limit=50');

        if (data.messages.length === 0) {
          tbody.innerHTML = '<tr><td colspan="3" class="empty-state"><div class="empty-icon">&#9888;</div>No messages in DLQ</td></tr>';
          return;
        }

        tbody.innerHTML = data.messages.map(m => `
          <tr>
            <td><code>${m.originalSubject}</code></td>
            <td>${m.reason}</td>
            <td>${formatDate(m.movedAt)}</td>
          </tr>
        `).join('');
      } catch (err) {
        tbody.innerHTML = '<tr><td colspan="3" class="empty-state">Failed to load DLQ</td></tr>';
      }
    }

    // Audit Logs
    async function loadAuditLogs(page = 1) {
      const tbody = document.getElementById('auditTableBody');
      tbody.innerHTML = '<tr><td colspan="5" class="loading"><div class="spinner"></div></td></tr>';

      try {
        const data = await apiCall(`/admin/audit-logs?page=${page}&limit=50`);

        if (data.logs.length === 0) {
          tbody.innerHTML = '<tr><td colspan="5" class="empty-state"><div class="empty-icon">&#128220;</div>No audit logs</td></tr>';
          return;
        }

        tbody.innerHTML = data.logs.map(l => `
          <tr>
            <td><span class="badge user">${l.action}</span></td>
            <td>${l.userId}</td>
            <td>${l.targetType ? `${l.targetType}:${l.targetId}` : '-'}</td>
            <td>${formatDate(l.createdAt)}</td>
            <td><code style="font-size: 11px;">${l.ipAddress || '-'}</code></td>
          </tr>
        `).join('');

        updatePagination('audit', data.pagination);
      } catch (err) {
        tbody.innerHTML = '<tr><td colspan="5" class="empty-state">Failed to load audit logs</td></tr>';
      }
    }

    // Pagination
    function updatePagination(type, pagination) {
      const container = document.getElementById(`${type}Pagination`);
      if (!container || !pagination) return;

      const info = container.querySelector('.pagination-info');
      const buttons = container.querySelector('.pagination-buttons');

      const start = (pagination.page - 1) * pagination.limit + 1;
      const end = Math.min(pagination.page * pagination.limit, pagination.total);
      info.textContent = `Showing ${start}-${end} of ${pagination.total}`;

      buttons.innerHTML = `
        <button class="page-btn" ${pagination.page <= 1 ? 'disabled' : ''} onclick="paginate('${type}', ${pagination.page - 1})">Prev</button>
        <button class="page-btn active">${pagination.page}</button>
        <button class="page-btn" ${pagination.page >= pagination.totalPages ? 'disabled' : ''} onclick="paginate('${type}', ${pagination.page + 1})">Next</button>
      `;
    }

    function paginate(type, page) {
      switch(type) {
        case 'users': loadUsers(page, document.getElementById('userSearch').value); break;
        case 'consumers': loadConsumers(page); break;
        case 'webhooks': loadWebhooks(page, document.getElementById('webhookFilter').value); break;
        case 'audit': loadAuditLogs(page); break;
      }
    }

    // Utility
    function debounce(fn, delay) {
      let timer;
      return (...args) => {
        clearTimeout(timer);
        timer = setTimeout(() => fn(...args), delay);
      };
    }

    // Modal close handlers
    document.getElementById('modalClose').addEventListener('click', hideModal);
    document.getElementById('modalOverlay').addEventListener('click', (e) => {
      if (e.target === e.currentTarget) hideModal();
    });

    // Init
    if (token) {
      apiCall('/admin/stats')
        .then(() => apiCall('/auth/me'))
        .then(user => {
          currentUser = user;
          showDashboard();
        })
        .catch(() => {
          localStorage.removeItem('adminToken');
          token = null;
        });
    }
  </script>
</body>
</html>
